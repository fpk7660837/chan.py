# 缠论ML框架新手使用指南

## 目标读者
本指南适合：
- 刚安装Python的新手
- 使用PyCharm IDE的用户
- 想要使用机器学习增强缠论买卖点判断的用户

---

## 第一步：检查Python环境

### 1.1 检查Python版本
打开PyCharm的Terminal（底部工具栏），输入：
```bash
python --version
```
确保Python版本 >= 3.8（推荐3.9或3.10）

### 1.2 确认项目路径
在Terminal中，输入：
```bash
pwd
```
应该显示：`/Users/fupengkai/Documents/quant/chan.py`（或你的项目路径）

---

## 第二步：安装依赖包

### 2.1 安装基础依赖
在PyCharm的Terminal中依次执行：

```bash
# 安装机器学习必需的包
pip install lightgbm scikit-learn numpy pandas

# 安装可选的包（如果你想用XGBoost）
pip install xgboost

# 安装数据获取包（akshare用于获取A股数据）
pip install akshare

# 如果下载速度慢，可以使用国内镜像源
pip install lightgbm scikit-learn numpy pandas -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 2.2 验证安装
```bash
python -c "import lightgbm; print('LightGBM版本:', lightgbm.__version__)"
python -c "import sklearn; print('Sklearn版本:', sklearn.__version__)"
```

如果没有报错，说明安装成功。

---

## 第三步：理解项目结构

用PyCharm打开项目，你会看到：

```
chan.py/
├── ML/                    ← 机器学习核心模块（新增）
│   ├── FeatureEngine/     ← 特征提取
│   ├── Models/            ← 模型管理
│   ├── Training/          ← 训练模块
│   ├── Prediction/        ← 预测模块
│   ├── Evaluation/        ← 评估模块
│   ├── Backtest/          ← 回测模块
│   └── Utils/             ← 工具模块
├── Config/                ← 配置模块（新增）
│   └── MLConfig.py        ← ML配置文件
├── Examples/              ← 示例代码（新增）⭐ 从这里开始
│   ├── train_model_demo.py    ← 训练示例
│   ├── predict_demo.py        ← 预测示例
│   └── backtest_demo.py       ← 回测示例
├── Chan.py                ← 核心缠论类（原有）
├── Common/                ← 公共模块（原有）
└── BuySellPoint/          ← 买卖点模块（原有）
```

**重点关注3个文件夹：**
- `ML/` - 机器学习核心代码（一般不需要修改）
- `Config/` - 配置文件（可以调整参数）
- `Examples/` - 运行示例（⭐你的入口点）

---

## 第四步：第一次运行（训练模型）

### 4.1 打开训练示例
在PyCharm左侧项目树中，找到并打开：
```
Examples/train_model_demo.py
```

### 4.2 理解代码结构
这个文件大约180行，分为5个步骤：

```python
# Step 1: 准备训练数据
train_chan_list = prepare_training_data()
# 会从akshare下载5只股票的2020-2022年日线数据

# Step 2: 准备测试数据
test_chan_list = prepare_test_data()
# 会下载相同股票的2023年数据

# Step 3: 训练模型
model, config = train_model(train_chan_list, model_type='lightgbm')
# 使用LightGBM训练模型

# Step 4: 保存模型
model_path = save_model(model, config, version='v1.0')
# 保存到 ./models/ 目录

# Step 5: 评估模型
metrics = evaluate_model(model, test_chan_list, config)
# 在测试集上评估效果
```

### 4.3 运行训练
在PyCharm中：
1. 右键点击 `train_model_demo.py`
2. 选择 "Run 'train_model_demo'"
3. 或者直接点击右上角的绿色▶️按钮

**⚠️ 第一次运行会比较慢**（需要下载股票数据），预计10-20分钟，耐心等待。

### 4.4 查看输出
Terminal会显示类似这样的输出：

```
================================================================================
Chan Theory ML Training Demo
================================================================================

Step 1: Preparing training data...
================================================================================

Loading data for 600000...
  Loaded 600000 successfully

Loading data for 600016...
  Loaded 600016 successfully

...

================================================================================
Step 3: Training lightgbm model...
================================================================================
Found 1523 buy/sell points

Extracted 30 features from 1523 samples

Label distribution: 456 positive (29.94%), 1067 negative (70.06%)

Train set: 1218 samples, Test set: 305 samples

Training model...
[LightGBM] [Info] ...
Model training completed!

Top 10 important features:
  1. bi_macd_area: 0.2456
  2. seg_slope: 0.1823
  3. volatility: 0.1456
  ...

================================================================================
Training completed successfully!
================================================================================

Model saved to: ./models/model_v1.0.pkl
```

### 4.5 检查结果
训练完成后，会在项目根目录生成 `models/` 文件夹：
```
chan.py/
└── models/
    ├── model_v1.0.pkl        ← 训练好的模型
    └── metadata_v1.0.json    ← 模型元数据（配置、特征名等）
```

---

## 第五步：使用模型预测

### 5.1 打开预测示例
```
Examples/predict_demo.py
```

### 5.2 理解预测流程
```python
# Step 1: 加载模型
model, metadata = load_model(version=None)  # None表示加载最新版本

# Step 2: 准备新数据
chan = prepare_prediction_data(code='600519', begin_time='2024-01-01')
# 获取茅台2024年的数据

# Step 3: 预测买卖点质量
top_buy, top_sell = predict_bsp_quality(model, chan, metadata)
# 找出质量最高的5个买点和5个卖点

# Step 4: 根据阈值筛选
filtered_buy, filtered_sell = filter_by_threshold(model, chan, metadata, threshold=0.7)
# 筛选出分数>=0.7的买卖点
```

### 5.3 运行预测
1. 右键点击 `predict_demo.py`
2. 选择 "Run 'predict_demo'"

### 5.4 查看预测结果
```
================================================================================
Top 5 BUY points (highest quality):
--------------------------------------------------------------------------------

1. Buy Point:
   Time: 2024-03-15 00:00:00
   Type: 1买
   Price: 1650.50
   Quality Score: 0.8523 (85.23%)  ← 这个买点质量很高！

2. Buy Point:
   Time: 2024-05-20 00:00:00
   Type: 2买
   Price: 1580.30
   Quality Score: 0.7845 (78.45%)

3. Buy Point:
   Time: 2024-07-10 00:00:00
   Type: 3买
   Price: 1720.60
   Quality Score: 0.7234 (72.34%)

...
```

**📊 分数含义：**
- **0.85 (85%)** = 85%的概率是个好买点（未来20天会上涨5%以上）
- **0.50 (50%)** = 50%，相当于随机猜测
- **0.30 (30%)** = 30%，很可能是个坏买点，不建议买入

---

## 第六步：回测验证效果

### 6.1 打开回测示例
```
Examples/backtest_demo.py
```

### 6.2 理解回测流程
```python
# Step 1: 加载模型
model, metadata = load_model()

# Step 2: 准备回测数据（多只股票的历史数据）
test_chan_list = prepare_backtest_data()

# Step 3: 运行回测
metrics = run_backtest(model, test_chan_list, metadata)
# 模拟：如果按照模型预测的信号交易，会赚多少钱

# Step 4: 对比不同阈值
threshold_results = compare_thresholds(model, test_chan_list, metadata)
# 测试阈值0.5、0.6、0.7、0.8哪个效果最好
```

### 6.3 运行回测
右键运行 `backtest_demo.py`

### 6.4 查看回测结果
```
============================================================
Backtest Results
============================================================

Classification Metrics:
  Auc                 : 0.7523
  Precision           : 0.6845

Trading Metrics:
  Total Return        : 45.23%      ← 总收益率
  Sharpe Ratio        : 1.8234      ← 夏普比率（越高越好）
  Calmar Ratio        : 2.1567      ← 卡玛比率
  Max Drawdown        : 12.45%      ← 最大回撤
  Win Rate            : 0.6523      ← 胜率（65.23%）
  Profit Loss Ratio   : 2.3456      ← 盈亏比（赚的是亏的2.3倍）
  Total Trades        : 156         ← 总交易次数

============================================================

Threshold Comparison Summary
============================================================
Threshold    Signals    Win Rate     Sharpe       Calmar       Total Return
--------------------------------------------------------------------------------
0.50         245        0.5823       1.2345       1.5678       32.45%
0.60         189        0.6234       1.5678       1.8901       38.56%
0.70         156        0.6523       1.8234       2.1567       45.23%  ← 最好
0.80         98         0.6845       1.6789       1.9876       41.23%

Best threshold (by Sharpe ratio): 0.70
  Sharpe ratio: 1.8234
  Win rate: 0.6523
  Total return: 45.23%
```

**📈 指标含义：**
- **夏普比率 (Sharpe Ratio)**：风险调整后收益，>1.5就算不错，>2.0很优秀
- **胜率 (Win Rate)**：盈利交易占比，>60%算好
- **盈亏比 (Profit/Loss Ratio)**：>2.0说明赚的时候赚得多，亏的时候亏得少
- **最大回撤 (Max Drawdown)**：历史最大亏损幅度，<15%可接受

---

## 第七步：调整参数优化效果

### 7.1 修改标签策略
打开 `Config/MLConfig.py`，找到第28行附近：

```python
# 标签构建配置（基于未来收益率策略）
label_config: Dict[str, Any] = field(default_factory=lambda: {
    'label_strategy': 'future_return',  # 标签策略：未来收益率
    'lookforward_bars': 20,             # 未来N根K线 ⬅️ 可以改成30试试
    'threshold_pct': 0.05,              # 收益率阈值（5%） ⬅️ 可以改成0.03试试
    'use_highest_for_buy': True,        # 买点使用最高价
    'use_lowest_for_sell': True,        # 卖点使用最低价
})
```

**参数说明：**
- `lookforward_bars`:
  - 改成**30** = 看未来30天（更长期）
  - 改成**10** = 看未来10天（更短期）
- `threshold_pct`:
  - 改成**0.03** = 3%就算成功（标准更宽松，正样本更多）
  - 改成**0.08** = 8%才算成功（标准更严格，正样本更少）

### 7.2 修改模型参数
找到第37行附近：

```python
# 模型配置
model_config: Dict[str, Any] = field(default_factory=lambda: {
    'model_type': 'lightgbm',  # ⬅️ 可以改成'xgboost'或'randomforest'
    'lightgbm_params': {
        'objective': 'binary',
        'metric': 'auc',
        'learning_rate': 0.05,   # ⬅️ 改成0.01（学习慢一点，可能更准确）
        'num_leaves': 31,
        'max_depth': -1,
        'min_child_samples': 20,
        'n_estimators': 100,     # ⬅️ 改成200（更多树，可能更准确但更慢）
        'subsample': 0.8,
        'colsample_bytree': 0.8,
        'random_state': 42,
        'verbose': -1,
    },
})
```

### 7.3 重新训练
修改参数后：
1. 保存 `MLConfig.py`
2. 重新运行 `train_model_demo.py`
3. 模型会以新版本号保存（如v1.1、v1.2...）
4. 对比不同版本的回测效果

---

## 第八步：在实际项目中使用

### 8.1 创建你自己的脚本
在PyCharm中创建新文件 `my_trading_strategy.py`：

```python
"""
我的交易策略

使用训练好的模型分析股票，找出高质量买卖点
"""

import sys
import os
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from Chan import CChan
from Common.CEnum import KL_TYPE, DATA_SRC
from ML.Utils.ModelIO import ModelIO
from ML.Prediction.Predictor import Predictor
from ML.FeatureEngine.BSPFeatureExtractor import BSPFeatureExtractor


def analyze_stock(code, begin_time='2024-01-01', end_time='2024-12-31'):
    """
    分析一只股票，找出高质量买点

    Args:
        code: 股票代码，如'600519'（贵州茅台）、'000001'（平安银行）
        begin_time: 开始时间
        end_time: 结束时间
    """
    print(f"\n{'='*80}")
    print(f"分析股票: {code}")
    print(f"{'='*80}")

    # 1. 加载训练好的模型
    print("\n[1] 加载模型...")
    model_io = ModelIO('./models')
    model = model_io.load()  # 自动加载最新版本
    metadata = model_io.load_metadata()
    print(f"    模型版本: {metadata.get('version', 'Unknown')}")

    # 2. 创建预测器
    print("\n[2] 创建预测器...")
    feature_extractor = BSPFeatureExtractor(metadata['config']['feature_config'])
    predictor = Predictor(model, feature_extractor)

    # 3. 获取股票数据
    print(f"\n[3] 获取股票数据...")
    chan = CChan(
        code=code,
        begin_time=begin_time,
        end_time=end_time,
        data_src=DATA_SRC.AKSHARE,
        lv_list=[KL_TYPE.K_DAY]
    )
    print(f"    数据加载完成")

    # 4. 预测买点
    print(f"\n[4] 分析买点质量...")
    top_buy_points = predictor.rank_bsp(chan, top_k=5, direction='buy')

    # 5. 打印结果
    print(f"\n{'='*80}")
    print(f"{code} 最佳买点分析（Top 5）")
    print(f"{'='*80}")

    if len(top_buy_points) == 0:
        print("未找到买点")
        return

    for i, (bsp, score) in enumerate(top_buy_points, 1):
        print(f"\n第{i}个买点：")
        print(f"  时间：{bsp.klu.time}")
        print(f"  价格：{bsp.klu.close:.2f}")
        print(f"  类型：{bsp.type.value}")
        print(f"  质量分数：{score:.4f} ({score*100:.2f}%)")

        # 决策逻辑
        if score >= 0.8:
            print(f"  建议：⭐⭐⭐ 强烈推荐买入！")
            print(f"  理由：质量分数>=80%，历史数据显示这种买点成功率很高")
        elif score >= 0.7:
            print(f"  建议：⭐⭐ 可以考虑买入")
            print(f"  理由：质量分数>=70%，是个不错的买点")
        elif score >= 0.6:
            print(f"  建议：⭐ 谨慎观望")
            print(f"  理由：质量分数60-70%，建议等待更好的机会")
        else:
            print(f"  建议：不建议买入")
            print(f"  理由：质量分数<60%，成功率较低")

    print(f"\n{'='*80}\n")

    # 6. 预测卖点
    print(f"\n[5] 分析卖点质量...")
    top_sell_points = predictor.rank_bsp(chan, top_k=5, direction='sell')

    print(f"\n{'='*80}")
    print(f"{code} 最佳卖点分析（Top 5）")
    print(f"{'='*80}")

    if len(top_sell_points) == 0:
        print("未找到卖点")
        return

    for i, (bsp, score) in enumerate(top_sell_points, 1):
        print(f"\n第{i}个卖点：")
        print(f"  时间：{bsp.klu.time}")
        print(f"  价格：{bsp.klu.close:.2f}")
        print(f"  类型：{bsp.type.value}")
        print(f"  质量分数：{score:.4f} ({score*100:.2f}%)")

        if score >= 0.8:
            print(f"  建议：⭐⭐⭐ 强烈推荐卖出！")
        elif score >= 0.7:
            print(f"  建议：⭐⭐ 可以考虑卖出")
        elif score >= 0.6:
            print(f"  建议：⭐ 谨慎观望")
        else:
            print(f"  建议：持有观察")

    print(f"\n{'='*80}\n")


if __name__ == '__main__':
    # 分析多只股票
    stocks = [
        '600519',  # 贵州茅台
        '000001',  # 平安银行
        '601318',  # 中国平安
    ]

    for code in stocks:
        try:
            analyze_stock(code, begin_time='2024-01-01', end_time='2024-12-31')
        except Exception as e:
            print(f"分析{code}时出错: {e}")
            continue

    print("\n所有股票分析完成！")
```

### 8.2 运行你的策略
右键运行 `my_trading_strategy.py`

### 8.3 查看分析结果
```
================================================================================
分析股票: 600519
================================================================================

[1] 加载模型...
    模型版本: v1.0

[2] 创建预测器...

[3] 获取股票数据...
    数据加载完成

[4] 分析买点质量...

================================================================================
600519 最佳买点分析（Top 5）
================================================================================

第1个买点：
  时间：2024-03-15 00:00:00
  价格：1650.50
  类型：1买
  质量分数：0.8523 (85.23%)
  建议：⭐⭐⭐ 强烈推荐买入！
  理由：质量分数>=80%，历史数据显示这种买点成功率很高

第2个买点：
  时间：2024-05-20 00:00:00
  价格：1580.30
  类型：2买
  质量分数：0.7845 (78.45%)
  建议：⭐⭐ 可以考虑买入
  理由：质量分数>=70%，是个不错的买点

...
```

---

## 第九步：常见问题解决

### 9.1 报错：No module named 'lightgbm'
**原因**：没有安装LightGBM

**解决**：
```bash
pip install lightgbm
```

### 9.2 报错：No module named 'Chan'
**原因**：不在正确的目录下运行

**解决**：
```bash
# 1. 检查当前目录
pwd

# 2. 如果不对，切换到项目目录
cd /Users/fupengkai/Documents/quant/chan.py

# 3. 或者在代码开头加上这两行
import sys
sys.path.insert(0, '/Users/fupengkai/Documents/quant/chan.py')
```

### 9.3 下载股票数据失败
**可能原因**：网络问题、股票代码错误、akshare接口限制

**解决方法1**：换个时间重试（避开交易时间）

**解决方法2**：修改股票代码列表
```python
# 从这些股票
train_codes = ['600000', '600016', '600036', '600519', '000001']

# 改成这些（选一些常见的大盘股）
train_codes = ['600519', '000001', '601318']  # 茅台、平安银行、中国平安
```

**解决方法3**：减少数据量
```python
# 修改训练示例中的代码
begin_time='2022-01-01',  # 从2020改成2022（数据量减少）
end_time='2022-12-31',
```

### 9.4 训练时间太长
**原因**：数据量太大、模型参数太多

**解决**：
```python
# 方法1：减少股票数量
train_codes = ['600519', '000001']  # 从5只改成2只

# 方法2：缩短时间范围
begin_time='2022-01-01',  # 从2020改成2022

# 方法3：减少模型复杂度（修改Config/MLConfig.py）
'n_estimators': 50,  # 从100改成50（树的数量减半）
```

### 9.5 模型效果不好（胜率<50%）
**可能原因**：
- 训练数据不足
- 参数设置不合理
- 市场环境变化

**优化建议**：
```python
# 1. 增加训练数据
train_codes = ['600519', '000001', '601318', '600036', '600000', '600016']  # 更多股票
begin_time='2018-01-01',  # 更长时间

# 2. 调整标签策略
'lookforward_bars': 30,      # 增加预测周期
'threshold_pct': 0.03,       # 降低收益率阈值

# 3. 尝试不同模型
model_type='xgboost'  # 从lightgbm改成xgboost

# 4. 增加模型复杂度
'n_estimators': 200,         # 增加树的数量
'max_depth': 8,              # 增加树的深度
```

### 9.6 预测时报错：Feature names mismatch
**原因**：训练时的特征和预测时的特征不一致

**解决**：
```python
# 确保使用相同的配置
# 方法1：从元数据中获取配置
metadata = model_io.load_metadata()
feature_extractor = BSPFeatureExtractor(metadata['config']['feature_config'])

# 方法2：重新训练模型
# 删除 models/ 目录，重新运行 train_model_demo.py
```

---

## 第十步：进阶使用

### 10.1 在PyCharm中调试代码
1. 在行号左边点击，出现红点（断点）
2. 右键选择 "Debug 'xxx'"（而不是Run）
3. 代码会在断点处暂停
4. 在下方Variables窗口可以查看所有变量的值
5. 使用Step Over (F8) 逐行执行
6. 使用Resume (F9) 继续运行

**示例：调试预测过程**
```python
# 在这一行打断点
top_buy_points = predictor.rank_bsp(chan, top_k=5, direction='buy')

# 运行到这里会暂停，可以查看：
# - predictor 对象的内容
# - chan 对象中有多少个买卖点
# - 预测出来的 top_buy_points 列表
```

### 10.2 查看特征重要性
训练完成后，Terminal会显示：
```python
Top 10 important features:
  1. bi_macd_area: 0.2456       ← MACD面积最重要
  2. seg_slope: 0.1823          ← 线段斜率第二重要
  3. volatility: 0.1456         ← 波动率
  4. bi_amp: 0.1234             ← 笔振幅
  5. rsi: 0.1123                ← RSI指标
  ...
```

**利用特征重要性优化：**
```python
# 如果发现某些特征不重要，可以关闭
# 修改 Config/MLConfig.py
feature_config = {
    'use_bi_features': True,      # 笔特征很重要，保留
    'use_seg_features': True,     # 线段特征很重要，保留
    'use_zs_features': False,     # 如果中枢特征不重要，可以关闭
    'use_klu_features': True,     # K线指标很重要，保留
}
```

### 10.3 批量分析多只股票
创建 `batch_analysis.py`：

```python
import sys
import os
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from Chan import CChan
from Common.CEnum import KL_TYPE, DATA_SRC
from ML.Utils.ModelIO import ModelIO
from ML.Prediction.Predictor import Predictor
from ML.FeatureEngine.BSPFeatureExtractor import BSPFeatureExtractor
import pandas as pd


def batch_analyze(stock_list, top_k=3):
    """批量分析多只股票"""

    # 加载模型
    model_io = ModelIO('./models')
    model = model_io.load()
    metadata = model_io.load_metadata()

    feature_extractor = BSPFeatureExtractor(metadata['config']['feature_config'])
    predictor = Predictor(model, feature_extractor)

    # 存储所有结果
    all_results = []

    for code in stock_list:
        try:
            print(f"分析 {code}...")

            # 获取数据
            chan = CChan(
                code=code,
                begin_time='2024-01-01',
                end_time='2024-12-31',
                data_src=DATA_SRC.AKSHARE,
                lv_list=[KL_TYPE.K_DAY]
            )

            # 预测买点
            top_buy = predictor.rank_bsp(chan, top_k=top_k, direction='buy')

            # 保存结果
            for bsp, score in top_buy:
                all_results.append({
                    '股票代码': code,
                    '时间': bsp.klu.time,
                    '价格': bsp.klu.close,
                    '类型': bsp.type.value,
                    '质量分数': score,
                })

        except Exception as e:
            print(f"  {code} 分析失败: {e}")
            continue

    # 转换为DataFrame
    df = pd.DataFrame(all_results)

    # 按分数排序
    df = df.sort_values('质量分数', ascending=False)

    # 保存到Excel
    df.to_excel('买点分析结果.xlsx', index=False)
    print(f"\n结果已保存到: 买点分析结果.xlsx")

    # 打印前10个
    print("\n所有股票Top 10买点：")
    print(df.head(10).to_string(index=False))

    return df


if __name__ == '__main__':
    # 沪深300成分股（部分）
    stocks = [
        '600519', '000001', '601318', '600036', '600000',
        '600016', '601166', '601328', '600030', '601398',
    ]

    df = batch_analyze(stocks, top_k=3)
```

### 10.4 定时运行策略
在PyCharm中创建 `scheduled_strategy.py`：

```python
"""
定时运行策略

每天收盘后自动分析股票池，找出高质量买点
"""

import schedule
import time
from datetime import datetime
from my_trading_strategy import analyze_stock


def daily_analysis():
    """每日分析任务"""
    print(f"\n{'='*80}")
    print(f"每日分析开始 - {datetime.now()}")
    print(f"{'='*80}")

    # 你的股票池
    stock_pool = ['600519', '000001', '601318', '600036']

    for code in stock_pool:
        try:
            analyze_stock(code)
        except Exception as e:
            print(f"{code} 分析失败: {e}")

    print(f"\n{'='*80}")
    print(f"每日分析完成 - {datetime.now()}")
    print(f"{'='*80}\n")


if __name__ == '__main__':
    # 每天下午3点30分运行（A股收盘后）
    schedule.every().day.at("15:30").do(daily_analysis)

    print("定时任务已启动，等待每天15:30执行...")
    print("按Ctrl+C停止")

    while True:
        schedule.run_pending()
        time.sleep(60)  # 每分钟检查一次
```

安装schedule包：
```bash
pip install schedule
```

---

## 完整工作流程总结

```
┌─────────────────────────────────────────────────────────┐
│ 1. 安装依赖                                              │
│    pip install lightgbm scikit-learn numpy              │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│ 2. 训练模型（第一次使用）                                 │
│    运行 Examples/train_model_demo.py                    │
│    → 等待10-20分钟                                       │
│    → 生成 models/model_v1.0.pkl                         │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│ 3. 预测买卖点                                            │
│    运行 Examples/predict_demo.py                        │
│    → 看到高质量买卖点列表                                 │
│    → 分数>=0.8：强烈推荐                                 │
│    → 分数>=0.7：可以考虑                                 │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│ 4. 回测验证                                              │
│    运行 Examples/backtest_demo.py                       │
│    → 看到历史收益率、胜率等指标                           │
│    → 如果夏普比率>1.5，说明模型不错                       │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│ 5. 调整参数优化（可选）                                   │
│    修改 Config/MLConfig.py                              │
│    → 调整lookforward_bars、threshold_pct                │
│    → 重新训练 → 重新回测 → 对比效果                      │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│ 6. 实战应用                                              │
│    创建 my_trading_strategy.py                          │
│    → 加载模型                                            │
│    → 分析你的股票池                                       │
│    → 根据质量分数做出买卖决策                             │
└─────────────────────────────────────────────────────────┘
```

---

## 快速参考卡片

### 🚀 三个核心示例
| 文件 | 作用 | 运行时间 | 何时使用 |
|------|------|----------|----------|
| `train_model_demo.py` | 训练模型 | 10-20分钟 | 第一次使用，或参数调整后 |
| `predict_demo.py` | 预测买卖点 | 1-2分钟 | 分析新股票时 |
| `backtest_demo.py` | 回测验证 | 3-5分钟 | 评估模型效果 |

### 📊 质量分数参考
| 分数范围 | 含义 | 建议 |
|----------|------|------|
| >= 0.8 | 优秀买点 | ⭐⭐⭐ 强烈推荐 |
| 0.7 - 0.8 | 良好买点 | ⭐⭐ 可以考虑 |
| 0.6 - 0.7 | 一般买点 | ⭐ 谨慎观望 |
| < 0.6 | 较差买点 | ❌ 不建议买入 |

### 🎯 回测指标参考
| 指标 | 优秀 | 良好 | 一般 |
|------|------|------|------|
| 夏普比率 | > 2.0 | 1.5 - 2.0 | 1.0 - 1.5 |
| 胜率 | > 65% | 55% - 65% | 45% - 55% |
| 盈亏比 | > 2.5 | 1.5 - 2.5 | 1.0 - 1.5 |
| 最大回撤 | < 10% | 10% - 15% | 15% - 20% |

### 🔧 常用配置参数
```python
# Config/MLConfig.py

# 短线交易（激进）
lookforward_bars = 10
threshold_pct = 0.03

# 中线交易（均衡）- 默认推荐
lookforward_bars = 20
threshold_pct = 0.05

# 长线交易（保守）
lookforward_bars = 30
threshold_pct = 0.08
```

---

## 需要帮助？

### 📚 文档位置
- **ML模块详细文档**：`ML/README.md`
- **本新手指南**：`Examples/新手使用指南.md`

### ❓ 遇到问题怎么办
1. **先看错误信息**：PyCharm底部Terminal会显示详细错误
2. **检查环境**：确认Python版本、依赖包是否正确安装
3. **查看示例代码**：Examples/目录下有完整可运行的示例
4. **对比配置**：确认MLConfig.py的参数设置合理

### 💡 学习建议
1. **从示例开始**：先运行3个demo，理解整个流程
2. **小步迭代**：每次只修改一个参数，观察效果变化
3. **做好记录**：记录每个版本的参数和回测结果
4. **积累经验**：多试验不同股票、不同参数组合

---

## 祝你使用愉快！🎉

记住：
- ✅ 第一次使用：运行 `train_model_demo.py` 训练模型
- ✅ 分析股票：运行 `predict_demo.py` 或创建自己的策略脚本
- ✅ 验证效果：运行 `backtest_demo.py` 查看历史表现
- ✅ 持续优化：调整参数，重新训练，对比效果

**现在就开始吧！打开PyCharm，运行第一个示例！** 🚀
